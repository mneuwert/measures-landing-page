// Multi-language support
const translations = {
    en: {
        // Header
        appName: "Measures",
        
        // Hero Section
        ultimateConverter: "The Ultimate",
        unitConverter: "Unit Converter",
        forIOS: "for iOS",
        heroDescription: "Convert between 971 units across 40 categories with real-time currency rates. Perfect for scientists, engineers, students, and professionals.",
        rating: "4.8 rating",
        units: "971 units",
        categories: "40 categories",
        currencies: "173 currencies",
        
        // Features Section
        completelyRedesigned: "Completely Redesigned",
        featuresDescription: "Experience the most intuitive and powerful unit converter with a modern interface designed for professionals and everyday users alike.",
        scientificCalculator: "Scientific Calculator",
        scientificCalculatorDesc: "Advanced mathematical functions for complex calculations and conversions.",
        realtimeCurrency: "Real-time Currency",
        realtimeCurrencyDesc: "173 currencies with automatic real-time exchange rates updated continuously.",
        enhancedFavorites: "Enhanced Favorites",
        enhancedFavoritesDesc: "Save conversions with drag & drop reordering for instant access to your most used units.",
        intelligentSearch: "Intelligent Search",
        intelligentSearchDesc: "Find any unit instantly with smart search and instant results.",
        
        // Categories Section
        professionalCategories: "Professional Categories",
        categoriesDescription: "971 units across 40 comprehensive categories",
        traditional: "Traditional",
        traditionalDesc: "Length, mass, volume, area, temperature",
        scientific: "Scientific",
        scientificDesc: "Energy, force, pressure, density, viscosity",
        specialized: "Specialized",
        specializedDesc: "Clothing sizes, blood sugar, typography",
        currenciesTitle: "Currencies",
        currenciesDesc: "173 countries with real-time rates",
        
        // CTA Section
        readyToConvert: "Ready to convert with precision?",
        ctaDescription: "Join thousands of professionals who trust Measures for accurate conversions. Works completely offline - no internet required.",
        
        // Footer
        ultimateUnitConverter: "The ultimate unit converter for iOS",
        privacyPolicy: "Privacy Policy",
        support: "Support",
        appStore: "App Store",
        copyright: "© 2025 Measures. All rights reserved."
    },
    de: {
        // Header
        appName: "Measures",
        
        // Hero Section
        ultimateConverter: "Der ultimative",
        unitConverter: "Einheitenrechner",
        forIOS: "für iOS",
        heroDescription: "Konvertieren Sie zwischen 971 Einheiten in 40 Kategorien mit Echtzeit-Wechselkursen. Perfekt für Wissenschaftler, Ingenieure, Studenten und Fachkräfte.",
        rating: "4,8 Bewertung",
        units: "971 Einheiten",
        categories: "40 Kategorien",
        currencies: "173 Währungen",
        
        // Features Section
        completelyRedesigned: "Völlig neu gestaltet",
        featuresDescription: "Erleben Sie den intuitivsten und leistungsstärksten Einheitenrechner mit einer modernen Benutzeroberfläche für Profis und Alltagsnutzer.",
        scientificCalculator: "Wissenschaftlicher Rechner",
        scientificCalculatorDesc: "Erweiterte mathematische Funktionen für komplexe Berechnungen und Umrechnungen.",
        realtimeCurrency: "Echtzeit-Währungen",
        realtimeCurrencyDesc: "173 Währungen mit automatischen Echtzeit-Wechselkursen, die kontinuierlich aktualisiert werden.",
        enhancedFavorites: "Erweiterte Favoriten",
        enhancedFavoritesDesc: "Speichern Sie Umrechnungen mit Drag & Drop-Neuordnung für sofortigen Zugriff auf Ihre meistgenutzten Einheiten.",
        intelligentSearch: "Intelligente Suche",
        intelligentSearchDesc: "Finden Sie jede Einheit sofort mit intelligenter Suche und Sofortergebnissen.",
        
        // Categories Section
        professionalCategories: "Professionelle Kategorien",
        categoriesDescription: "971 Einheiten in 40 umfassenden Kategorien",
        traditional: "Traditionell",
        traditionalDesc: "Länge, Masse, Volumen, Fläche, Temperatur",
        scientific: "Wissenschaftlich",
        scientificDesc: "Energie, Kraft, Druck, Dichte, Viskosität",
        specialized: "Spezialisiert",
        specializedDesc: "Kleidergrößen, Blutzucker, Typografie",
        currenciesTitle: "Währungen",
        currenciesDesc: "173 Länder mit Echtzeit-Kursen",
        
        // CTA Section
        readyToConvert: "Bereit für präzise Umrechnungen?",
        ctaDescription: "Schließen Sie sich Tausenden von Fachkräften an, die Measures für genaue Umrechnungen vertrauen. Funktioniert vollständig offline - kein Internet erforderlich.",
        
        // Footer
        ultimateUnitConverter: "Der ultimative Einheitenrechner für iOS",
        privacyPolicy: "Datenschutzerklärung",
        support: "Support",
        appStore: "App Store",
        copyright: "© 2025 Measures. Alle Rechte vorbehalten."
    },
    zh: {
        // Header
        appName: "Measures",
        
        // Hero Section
        ultimateConverter: "终极",
        unitConverter: "单位转换器",
        forIOS: "iOS版",
        heroDescription: "在40个类别中转换971个单位，支持实时汇率。非常适合科学家、工程师、学生和专业人士。",
        rating: "4.8评分",
        units: "971个单位",
        categories: "40个类别",
        currencies: "173种货币",
        
        // Features Section
        completelyRedesigned: "全新设计",
        featuresDescription: "体验最直观、最强大的单位转换器，采用现代界面设计，适合专业人士和日常用户。",
        scientificCalculator: "科学计算器",
        scientificCalculatorDesc: "高级数学功能，用于复杂计算和转换。",
        realtimeCurrency: "实时货币",
        realtimeCurrencyDesc: "173种货币，自动实时汇率持续更新。",
        enhancedFavorites: "增强收藏",
        enhancedFavoritesDesc: "通过拖放重新排序保存转换，即时访问您最常用的单位。",
        intelligentSearch: "智能搜索",
        intelligentSearchDesc: "通过智能搜索和即时结果立即找到任何单位。",
        
        // Categories Section
        professionalCategories: "专业类别",
        categoriesDescription: "40个综合类别中的971个单位",
        traditional: "传统",
        traditionalDesc: "长度、质量、体积、面积、温度",
        scientific: "科学",
        scientificDesc: "能量、力、压力、密度、粘度",
        specialized: "专业",
        specializedDesc: "服装尺寸、血糖、版面设计",
        currenciesTitle: "货币",
        currenciesDesc: "173个国家的实时汇率",
        
        // CTA Section
        readyToConvert: "准备好精确转换了吗？",
        ctaDescription: "加入数千名信任Measures进行准确转换的专业人士。完全离线工作 - 无需互联网。",
        
        // Footer
        ultimateUnitConverter: "iOS终极单位转换器",
        privacyPolicy: "隐私政策",
        support: "支持",
        appStore: "App Store",
        copyright: "© 2025 Measures. 保留所有权利。"
    },
    ja: {
        // Header
        appName: "Measures",
        
        // Hero Section
        ultimateConverter: "究極の",
        unitConverter: "単位変換アプリ",
        forIOS: "iOS版",
        heroDescription: "40カテゴリー971単位の変換とリアルタイム為替レート。科学者、エンジニア、学生、専門家に最適。",
        rating: "4.8評価",
        units: "971単位",
        categories: "40カテゴリー",
        currencies: "173通貨",
        
        // Features Section
        completelyRedesigned: "完全リデザイン",
        featuresDescription: "プロフェッショナルと日常ユーザー向けに設計された現代的なインターフェースで、最も直感的で強力な単位変換器を体験してください。",
        scientificCalculator: "科学電卓",
        scientificCalculatorDesc: "複雑な計算と変換のための高度な数学関数。",
        realtimeCurrency: "リアルタイム通貨",
        realtimeCurrencyDesc: "173通貨の自動リアルタイム為替レートを継続的に更新。",
        enhancedFavorites: "強化されたお気に入り",
        enhancedFavoritesDesc: "ドラッグ&ドロップの並び替えで変換を保存し、最もよく使う単位に即座にアクセス。",
        intelligentSearch: "インテリジェント検索",
        intelligentSearchDesc: "スマート検索と即座の結果で任意の単位を瞬時に検索。",
        
        // Categories Section
        professionalCategories: "プロフェッショナルカテゴリー",
        categoriesDescription: "40の包括的カテゴリーに971単位",
        traditional: "従来型",
        traditionalDesc: "長さ、質量、体積、面積、温度",
        scientific: "科学",
        scientificDesc: "エネルギー、力、圧力、密度、粘度",
        specialized: "専門",
        specializedDesc: "衣類サイズ、血糖値、タイポグラフィ",
        currenciesTitle: "通貨",
        currenciesDesc: "173カ国のリアルタイムレート",
        
        // CTA Section
        readyToConvert: "精密な変換の準備はできましたか？",
        ctaDescription: "正確な変換でMeasuresを信頼する何千ものプロフェッショナルに参加しましょう。完全にオフラインで動作 - インターネット不要。",
        
        // Footer
        ultimateUnitConverter: "iOS究極の単位変換アプリ",
        privacyPolicy: "プライバシーポリシー",
        support: "サポート",
        appStore: "App Store",
        copyright: "© 2025 Measures. 全著作権所有。"
    }
};

// Language management
class LanguageManager {
    constructor() {
        this.currentLanguage = this.detectLanguage();
        this.init();
    }

    detectLanguage() {
        // Check URL parameter first
        const urlParams = new URLSearchParams(window.location.search);
        const urlLang = urlParams.get('lang');
        if (urlLang && translations[urlLang]) {
            return urlLang;
        }

        // Check localStorage
        const savedLang = localStorage.getItem('preferredLanguage');
        if (savedLang && translations[savedLang]) {
            return savedLang;
        }

        // Check browser language
        const browserLang = navigator.language.toLowerCase();
        if (browserLang.startsWith('de')) return 'de';
        if (browserLang.startsWith('zh')) return 'zh';
        if (browserLang.startsWith('ja')) return 'ja';
        
        // Default to English
        return 'en';
    }

    init() {
        this.updateHTML();
        this.updateScreenshots();
        this.updateContent();
    }

    setLanguage(lang) {
        if (translations[lang]) {
            this.currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            this.updateContent();
            this.updateScreenshots();
            this.updateHTML();
            this.updateURL();
        }
    }

    updateContent() {
        const t = translations[this.currentLanguage];
        
        // Update all elements with data-translate attributes
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (t[key]) {
                element.textContent = t[key];
            }
        });

        // Update meta tags
        document.title = `${t.appName} - ${t.ultimateConverter} ${t.unitConverter} ${t.forIOS}`;
        document.querySelector('meta[name="description"]').setAttribute('content', t.heroDescription);
        document.querySelector('meta[property="og:title"]').setAttribute('content', `${t.appName} - ${t.ultimateConverter} ${t.unitConverter} ${t.forIOS}`);
        document.querySelector('meta[property="og:description"]').setAttribute('content', t.heroDescription);
        document.querySelector('meta[property="twitter:title"]').setAttribute('content', `${t.appName} - ${t.ultimateConverter} ${t.unitConverter} ${t.forIOS}`);
        document.querySelector('meta[property="twitter:description"]').setAttribute('content', t.heroDescription);
    }

    updateScreenshots() {
        // Map language codes to filename codes
        const langToFilename = {
            'en': 'en',
            'de': 'de', 
            'zh': 'cn',  // Chinese: zh -> cn
            'ja': 'jp'   // Japanese: ja -> jp
        };
        
        const filenameLang = langToFilename[this.currentLanguage];
        
        // Force update all screenshot images
        const allImages = document.querySelectorAll('img[src*="images/0"]');
        allImages.forEach(img => {
            const src = img.getAttribute('src');
            // Extract number from current src (01, 02, 03, 04, 05)
            const match = src.match(/(\d+)_[a-z]{2}\.png$/);
            if (match) {
                const imageNumber = match[1];
                const newSrc = `images/${imageNumber}_${filenameLang}.png`;
                img.src = newSrc;
            }
        });

        // Update meta image
        document.querySelector('meta[property="og:image"]').setAttribute('content', `images/01_${filenameLang}.png`);
        document.querySelector('meta[property="twitter:image"]').setAttribute('content', `images/01_${filenameLang}.png`);
    }

    updateHTML() {
        document.documentElement.lang = this.currentLanguage;
    }

    updateURL() {
        const url = new URL(window.location);
        url.searchParams.set('lang', this.currentLanguage);
        window.history.replaceState({}, '', url);
    }
}

// Landing page JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Initialize language manager
    const languageManager = new LanguageManager();
    window.languageManager = languageManager; // Make it globally accessible

    // Language switcher functionality
    const languageSwitcher = document.getElementById('languageSwitcher');
    if (languageSwitcher) {
        // Add click listeners to flag buttons
        const flagButtons = languageSwitcher.querySelectorAll('.flag-button');
        flagButtons.forEach(button => {
            button.addEventListener('click', function() {
                const selectedLang = this.getAttribute('data-lang');
                languageManager.setLanguage(selectedLang);
                
                // Update active state
                flagButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Set initial active state
        const currentButton = languageSwitcher.querySelector(`[data-lang="${languageManager.currentLanguage}"]`);
        if (currentButton) {
            flagButtons.forEach(btn => btn.classList.remove('active'));
            currentButton.classList.add('active');
        }
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Intersection Observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('slide-in');
            }
        });
    }, observerOptions);

    // Observe elements for animation
    document.querySelectorAll('.animate-on-scroll').forEach(el => {
        observer.observe(el);
    });

    // App Store download tracking (optional)
    document.querySelectorAll('a[href*="apps.apple.com"]').forEach(link => {
        link.addEventListener('click', function() {
            // Track download clicks if analytics are setup
            if (typeof gtag !== 'undefined') {
                gtag('event', 'click', {
                    'event_category': 'App Store',
                    'event_label': 'Download Button'
                });
            }
        });
    });
});